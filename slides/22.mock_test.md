### Mock Test (cont.)

```javascript
beforeEach(function () {
  userModelMock = sinon.mock(userModel);
  compareSync = sinon.spy(bcrypt, 'compareSync');
});
```

```javascript
it('should get error when cannot find user', function (done) {
  userModelMock
    .expects('findOne').withArgs({email: email})
    .chain('exec')
    .resolves(null);

  userModel.findUser(email, password, function (error) {
    userModelMock.verify();
    sinon.assert.notCalled(compareSync);
    expect(error).not.be.null;
    done();
  });
});
```

```javascript
afterEach(function () {
  userModelMock.restore();
  compareSync.restore();
});
```